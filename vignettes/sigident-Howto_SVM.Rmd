---
title: "sigident - SVM Example"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{sigident-SVM_example}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Prerequisites and installation 

Make sure, that both R packages, sigidnet.preproc and sigident, are installed.

## Initialization of important variables

```{r setup}
library(sigident)
library(sigident.preproc)
library(knitr)

# initialize filePath:
filePath <- tempdir()

# define datadir
maindir <- "./geodata/"
datadir <- paste0(maindir, "data/")
dir.create(maindir)
dir.create(datadir)

# define plotdir
plotdir <- "./plots/"
dir.create(plotdir)

# define idtype
idtype = "affy"

# general
csvdir <- "./csv/"
dir.create(csvdir)

# diagnostic signature
seed <- 111
split <- 0.8
nfolds <- 10
```

## Define list that contains a representation of the studies metadata

```{r}
studiesinfo <- list(
  "GSE18842" = list(
    setid = 1,
    targetcolname = "source_name_ch1",
    targetlevelname = "Human Lung Tumor",
    controllevelname = "Human Lung Control"
    ),
  
  "GSE19804" = list(
    setid = 1,
    targetcolname = "source_name_ch1",
    targetlevelname = "frozen tissue of primary tumor",
    controllevelname = "frozen tissue of adjacent normal"
  ),
  
  "GSE19188" = list(
    setid = 1,
    targetcolname = "characteristics_ch1",
    controllevelname = "tissue type: healthy",
    targetlevelname = "tissue type: tumor",
    use_rawdata = TRUE
  )
)
```

## Load GEO datasets

```{r results='hide', message=FALSE, warning=FALSE, error=FALSE}
sigident.preproc::load_geo_data(
  studiesinfo = studiesinfo,
  datadir = datadir,
  plotdir = plotdir,
  idtype = idtype,
  visualize_batches = FALSE
) 
```

# Apply SVM Classifier

```{r}
# Create training list
training_list <- sigident::create_training_test_split(
  diagnosis = diagnosis,
  mergeset = mergeset,
  split = split,
  seed = seed
)
                                               
# SVM
diagnostic_svm <- sigident::signature(
  traininglist = training_list,
  type = "svm",
  nfolds = nfolds,
  seed = seed
)
```


```{r eval=FALSE}
# Set variables
rm(list=ls())
pathDiagnosis = "vignettes/diagnosis.csv"
pathMergeset = "vignettes/mergeset_100.csv"
seed <- 111
split <- 0.8
nfolds <- 10
plotdir <- "./plots/"
dir.create(plotdir)

# Read in small mergeset file (1 000 features instead of 54 000)
mergesetData <- read.csv(pathMergeset, header=TRUE, row.names=1)

# Read in diagnosis file
diagnosisData <- read.csv(pathDiagnosis, header=TRUE, row.names=1)
# diagnosis <- subset(diagnosis, select=c("a"))

# Create training list
training_list <- sigident::create_training_test_split(diagnosis = diagnosisData,
                                               mergeset = mergesetData,
                                               split = split,
                                               seed = seed)
                                               
# SVM
diagnostic_svm <- sigident::signature(traininglist = training_list,
                                         type = "svm",
                                         nfolds = nfolds,
                                         seed = seed)
# filename <- paste0(plotdir, "CV_lasso.png")
# sigident::plot_cvplot(cv_obj = diagnostic_lasso$fit_cv,
#                         filename = filename)

# knitr::include_graphics(filename)

```

# Apply KNN Classifier

```{r}
# Create training list
# training_list <- sigident::create_training_test_split(
#   diagnosis = diagnosis,
#   mergeset = mergeset,
#   split = split,
#   seed = seed
# )


# KKNN
diagnostic_kknn <- sigident::signature(
  traininglist = training_list,
  type = "knn",
  nfolds = nfolds,
  seed = seed
)
```


```{r eval=FALSE}
# Set variables
rm(list=ls())
pathDiagnosis = "vignettes/diagnosis.csv"
pathMergeset = "vignettes/mergeset_100.csv"
seed <- 111
split <- 0.8
nfolds <- 10
plotdir <- "./plots/"
dir.create(plotdir)

# Read in small mergeset file (1 000 features instead of 54 000)
mergesetData <- read.csv(pathMergeset, header=TRUE, row.names=1)

# Read in diagnosis file
diagnosisData <- read.csv(pathDiagnosis, header=TRUE, row.names=1)
# diagnosis <- subset(diagnosis, select=c("a"))

# Create training list
training_list <- sigident::create_training_test_split(diagnosis = diagnosisData,
                                               mergeset = mergesetData,
                                               split = split,
                                               seed = seed)
                                               
# KNN
diagnostic_knn <- sigident::signature(traininglist = training_list,
                                         type = "knn",
                                         nfolds = nfolds,
                                         seed = seed)

# Random Forest
diagnostic_rf <- sigident::signature(traininglist = training_list,
                                        type = "random_forest",
                                        nfolds = nfolds,
                                        seed = seed)

```

